{"data":{"markdownRemark":{"htmlAst":{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"ç°¡åŒ–å¾Œé¡Œç›®æ•˜è¿°"}]},{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"showvariable","properties":{"varname":"description"},"children":[]}]},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"è¼¸å…¥èªªæ˜"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"è¼¸å…¥çš„ç¬¬ä¸€åˆ—åŒ…å«ä¸€å€‹æ­£æ•´æ•¸ $T$ ($1\\le T\\le 10^5$) ä»£è¡¨æ¸¬è©¦è³‡æ–™çµ„æ•¸ã€‚"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"æ¥ä¸‹ä¾†æœ‰ $T$ åˆ—ï¼Œæ¯ä¸€åˆ—ç‚ºä¸€çµ„æ¸¬è©¦è³‡æ–™ï¼ŒåŒ…å«ä¸‰å€‹æ­£æ•´æ•¸ $n, k, p$ï¼ˆ$1\\le n, k\\le 10^{18}, 1\\le p\\le 10^6$ï¼‰ã€‚"}]},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"OJ é€£çµ"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://open.kattis.com/problems/funwithfibonacci"},"children":[{"type":"text","value":"Open Kattis - Fun with Fibonacci"}]}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"é¡Œç›®å‡ºè™•"}]},{"type":"text","value":"ï¼šICPC 2018 Asia Hanoi Regional"}]},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"è§£æ³•"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"ä»Šå¤©æ˜¯æ•¸è«–å°æ•™å®¤ã€‚çœ‹åˆ°é€™é¡Œç¯„åœé€™éº¼å¤§ï¼Œå…¶ä¸­å¿…å®šæœ‰ç‚¸ã€‚"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"é€™é¡ŒçœŸçš„å¾ˆé›£ã€‚è€Œä¸”æ˜¯ä½ çœŸçš„è¦å°è²»æ°æ•¸åˆ—æœ‰æ‰€èªè­˜çš„é‚£ç¨®é›£ã€‚çœ‹åˆ°è¨ˆç®—è²»æ°æ•¸åˆ—é™¤ä»¥ $p$ çš„é¤˜æ•¸ï¼ˆæ³¨æ„é€™è£¡ $p$ ä¸æ˜¯è³ªæ•¸å”·ï¼‰ï¼Œå°±"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"æ‡‰è©²"}]},{"type":"text","value":"è¦æƒ³åˆ°è²»æ°æ•¸åˆ—æ¨¡ $p$ çš„å¾ªç’°ç¯€é•·åº¦æ˜¯ $O(p)$ çš„ï¼æ˜¯ä¸æ˜¯å¾ˆ OPï¼"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"è€Œäº‹å¯¦ä¸Šï¼Œæˆ‘å€‘å¯ä»¥åˆ©ç”¨ä»¥ä¸‹å®šç†åˆ»åŠƒå‡ºè²»æ°æ•¸åˆ—æ¨¡ $p$ çš„å¾ªç’°ç¯€é•·åº¦ï¼š"}]},{"type":"element","tagName":"theorem","properties":{"title":"è²»æ°æ•¸åˆ—çš„å¾ªç’°ç¯€"},"children":[{"type":"text","value":"\nè¨­ $p$ ç‚ºè³ªæ•¸ã€‚å‰‡ï¼š\n* ç•¶ $p=5$ çš„æ™‚å€™ $F_{20} \\equiv 0, F_{21}\\equiv 1 \\pmod 5$ã€‚\n    * é€™ä¿è­‰äº†å¾ªç’°ç¯€é•·åº¦æ•´é™¤ $20$ã€‚\n* ç•¶ $p\\equiv \\pm 1 \\pmod 5$ çš„æ™‚å€™ $F_{p-1} \\equiv 0, F_{p}\\equiv 1 \\pmod 5$ã€‚\n    * é€™ä¿è­‰äº†å¾ªç’°ç¯€é•·åº¦æ•´é™¤ $p-1$ã€‚\n* ç•¶ $p\\equiv \\pm 2 \\pmod 5$ çš„æ™‚å€™ $F_{2p+2}\\equiv 0, F_{2p+3}\\equiv 1 \\pmod 5$ã€‚\n    * é€™ä¿è­‰äº†å¾ªç’°ç¯€é•·åº¦æ•´é™¤ $2p+2$ã€‚\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"ç„¶å¾Œç¶“éåŠªåŠ›æ¨æ•²ä¸€ä¸‹ï¼Œå¯ä»¥æ¨å¾—å°ä»»æ„æ­£æ•´æ•¸ $r$ï¼Œæ¨¡ $p^r$ çš„æ™‚å€™ï¼Œå¾ªç’°ç¯€é•·åº¦æ•´é™¤ï¼š $p^{r-1} \\times (\\text{æ¨¡$p$çš„å¾ªç’°ç¯€é•·åº¦})$ã€‚å†æ ¹æ“šä¸­åœ‹å‰©é¤˜å®šç†ç”¨åŠ›è§€å¯Ÿä¸€ä¸‹ï¼Œå°±å¯ä»¥çŸ¥é“æŠŠä¸€å€‹æ­£æ•´æ•¸æ‹†æˆè¨±å¤šè³ªå› æ•¸çš„æ¬¡æ–¹ç©ï¼Œæ¯ä¸€å€‹éƒ¨ä»½çš„å¾ªç’°ç¯€é•·åº¦ä¹‹æœ€å°å…¬å€æ•¸ï¼ˆLCMï¼‰å°±æ˜¯æˆ‘å€‘è¦çš„ç­”æ¡ˆã€‚"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"ä¸Šé¢é€™å€‹å®šç†çš„è­‰æ˜å¯ä»¥åœ¨"},{"type":"element","tagName":"a","properties":{"href":"https://www.math.arizona.edu/~ura-reports/071/Campbell.Charles/Final.pdf"},"children":[{"type":"text","value":"é€™è£¡"}]},{"type":"text","value":"æ‰¾åˆ°å”·ï¼ˆæˆ‘ä¸å¤ªå–œæ­¡ä»–çš„è­‰æ˜ï¼Œæœ‰äº›åœ°æ–¹å®šç¾©ä¸æ˜¯å¾ˆæ¸…æ¥šçš„æ„Ÿè¦ºã€‚ä¹‹å¾Œæ‰¾åˆ°æ›´å¥½çš„å†æ›æ‰ã€‚ï¼‰"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"æœ‰äº†é€™å€‹ä»¥å¾Œï¼Œå°±å¯ä»¥çœŸçœŸæ­£æ­£åœ°é–‹å§‹ "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Fun With Fibonacci"}]},{"type":"text","value":" äº†ã€‚"}]},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"æŠŠå¾ªç’°ç¯€å¾€ä¸‹ä¸Ÿ"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"å°æ–¼ä»»æ„æ­£æ•´æ•¸ $p$ï¼Œæˆ‘å€‘ä»¤å‡½æ•¸ $f(p)$ è¡¨ç¤ºå¾ªç’°ç¯€å¤§å°ã€‚é¦–å…ˆæˆ‘å€‘å¯ä»¥åšå‡ºä»¥ä¸‹è§€å¯Ÿï¼š\n$G(i, n) \\bmod p = F_{G(i-1, n)} \\bmod p = F_{G(i-1, n)\\bmod f(p)} \\bmod p$ã€‚"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"æˆ‘å€‘å¯ä»¥æŠŠé€™å€‹å¯«æˆéè¿´é—œä¿‚ï¼Œé€éè§£æ±º $G(i-1, n)$ å›é ­è§£ $G(i, n)$ã€‚é€™å€‹éè¿´æœ€çµ‚å¾—è·‘é $k$ æ¬¡ï¼ŒåŸºæœ¬ä¸Šæ˜¯å€‹ $k=1000000000000000000$ æ¬¡çš„æ¦‚å¿µã€‚"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"ç¶“éäº†ä»Šå¤©å¤§é‡ TLE çš„æ´—ç¦®ï¼Œæˆ‘è§€å¯Ÿåˆ°äº†ä»¥ä¸‹å¹¾å€‹å¾ˆé…·ç‚«çš„é»ï¼š"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"$p, f(p), f(f(p)), f(f(f(p))), \\ldots$ é€™å€‹åºåˆ—éå¸¸å¿«å°±é€²å…¥å¾ªç’°äº†ã€‚è€Œä¸”ï¼Œåªè¦ 3~4 æ­¥ä»¥å¾Œå°±æœƒè·‘åˆ°"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"ä¸å‹•é»"}]},{"type":"text","value":"ï¼"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"å¤§éƒ¨åˆ†çš„ä¸å‹•é» $p$ï¼ˆi.e. $f(p)=p$ï¼‰ï¼Œéƒ½æ˜¯ $2^4\\times 3\\times 5^8$ çš„å› æ•¸ã€‚"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"è™•ç†ä¸å‹•é»"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"å¥½çš„ï¼Œç¾åœ¨å•é¡Œè®Šæˆäº†è™•ç† $F_{F_{F_{F_n}}} \\bmod p$...ï¼Œè€Œå¥½æ¶ˆæ¯æ˜¯æˆ‘å€‘ç¸½å¯ä»¥æŠŠ $\\bmod p$ å¾€è¨»æ¨™è£¡é¢ä¸Ÿã€‚"}]},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"åƒè€ƒç¨‹å¼ç¢¼"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"ä»Šå¤©çš„ç¨‹å¼ç¢¼çœŸçš„éå¸¸éå¸¸å‚·çœ¼ã€‚æˆ‘ä»¥å¾Œæœ‰ç©ºå†æŠŠå®ƒæ·¨åŒ–ä¸€ä¸‹ï¼ˆæ·šï¼‰"}]},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-cpp"]},"children":[{"type":"text","value":"#include <bits/stdc++.h>\nusing namespace std;\n\ntypedef long long LL;\nconst int N = 2000005;\nvector<bool> sieve(N);\nvector<int> primes;\n\nconst int VS = 18750000;\nint special[18750000];\n\nstruct Matrix {\n  LL a[2][2];\n  Matrix(LL A = 1, LL B = 0, LL C = 0, LL D = 1) {\n    a[0][0] = A;\n    a[0][1] = B;\n    a[1][0] = C;\n    a[1][1] = D;\n  }\n  Matrix operator % (const LL mod) const {\n    LL P = a[0][0]%mod;\n    LL Q = a[0][1]%mod;\n    LL R = Q;\n    LL S = a[1][1]%mod;\n    return Matrix(P, Q, R, S);\n  }\n  Matrix operator *(const Matrix m) const {\n    LL P = a[0][0] * m.a[0][0] + a[0][1] * m.a[1][0];\n    LL Q = a[0][0] * m.a[0][1] + a[0][1] * m.a[1][1];\n    LL R = Q;\n    LL S = a[1][0] * m.a[0][1] + a[1][1] * m.a[1][1];\n    return Matrix(P, Q, R, S);\n  }\n};\n\nMatrix MatrixPowerMod(Matrix A, LL n, LL mod) {\n  if (n == 0) return Matrix() % mod;\n  if (n == 1) return A % mod;\n  Matrix B = Matrix();\n  while (n > 0) {\n    if (n%2) B = B * A % mod;\n    A = A * A % mod;\n    n/=2;\n  }\n  return B;\n}\n\nLL Fib(LL n, LL mod) {\n  if (VS % mod == 0) return special[n] % mod;\n\n  Matrix A(1, 1, 1, 0);\n  A = MatrixPowerMod(A, n, mod);\n  return A.a[0][1];\n}\n\nLL GCD(LL x, LL y) {\n  while ((x%=y) && (y%=x));\n  return x+y;\n}\n\nLL LCM(LL x, LL y) {\n  return x / GCD(x, y) * y;\n}\n\nLL GetPrimePeriod(LL p, int k) {\n  LL result = 0;\n\n  if (p == 5) {\n    LL t = 20;\n    LL w = t; while(--k) w *= p;\n    return (result = w);\n  } else if (p%5 == 1 || p%5 == 4) {\n    LL N = 1; for(int _=0;_<k;_++) N*=p;\n    LL w = p-1; while(--k) w *= p;\n    return (result = w);\n  } else {\n    LL N = 1; for(int _=0;_<k;_++) N*=p;\n    LL w = 2*p+2; while(--k) w *= p;\n    return (result = w);\n  }\n}\n\nLL GetPeriod(LL m) {\n  LL t = 1;\n  LL copy = m;\n  for (int j = 0; primes[j] * primes[j] <= copy; j++) {\n    LL p = primes[j];\n    if (copy % p == 0) {\n      int power = 0;\n      do {\n        copy /= p;\n        ++power;\n      } while (copy % p == 0);\n      \n      t = LCM(t, GetPrimePeriod(p, power));\n    }\n  }\n  if (copy > 1) {\n   t = LCM(t, GetPrimePeriod(copy, 1));\n  }\n  return t;\n}\n\nvoid PreCompute() {\n  for (int i = 2; i <= 20000; i++) {\n    if (!sieve[i]) {\n      for (int j = i*i; j < N; j+=i)\n        sieve[j] = true;\n    }\n  }\n  for (int i = 2; i < N; i++)\n    if (!sieve[i])\n      primes.push_back(i);\n}\n\nLL pp;\nunordered_map<LL, int> pindex;\nunordered_map<LL, pair<int, int>> cycindex[128];\nvector<vector<LL>> bigcycles[128];\nint u[9375000];\nint idx[9375000] = {}, ucnt;\n\nLL getans(LL n, LL k, LL p) {\n  if (k == 1) {\n    return Fib(n, p);\n  }\n  LL next_period = GetPeriod(p);\n  if (p == next_period) {\n\n    if (pindex.find(p) == pindex.end()) {\n      int newidx = pindex.size();\n      pindex[p] = newidx;\n    }\n    int pidx = pindex[p];\n\n    vector<LL> g;\n    \n    ++ucnt;\n\n    n %= p;\n    g.push_back(n);\n    idx[n] = 0;\n    u[n] = ucnt;\n\n    for (LL i = 1; i <= k; i++) {\n      n = Fib(n, p);\n      if (cycindex[pidx].find(n) != cycindex[pidx].end()) {\n        auto [cidx, at] = cycindex[pidx][n];\n        vector<LL> &cycle = bigcycles[pidx][cidx];\n        int length = cycle.size();\n        i += (k-i)/length*length;\n        return cycle[ (k-i+at) % length ];\n      }\n      \n      //if (idx.find(n) != idx.end()) {\n      if (u[n] == ucnt) {\n        // found! from idx[n] to i-1.\n        int length = i - idx[n];\n\n        if (i>=10000 || length >=10000)\n        cerr << \"(pp=\" << pp << \") Found a cycle of length \" << length  << \" at index \" << i << endl;\n        if (length >= 1000) {\n          // Memorize it.\n          int cidx = bigcycles[pidx].size();\n          vector<LL> cycle;\n          for (int j = idx[n]; j < i; j++) {\n            cycle.push_back(g[j]);\n            cycindex[pidx][g[j]] = {cidx, j-idx[n]};\n          }\n          bigcycles[pidx].push_back(cycle);\n        }\n\n        i += (k-i)/length*length;\n        return g[idx[n] + k-i];\n      } else {\n        g.push_back(n);\n        idx[n] = i;\n        u[n] = ucnt;\n      }\n    }\n    return n;\n  }\n  LL t = getans(n, k-1, next_period);\n  return Fib(t, p);\n}\n\nvoid solve() {\n  LL n, k, p;\n  cin >> n >> k >> p;\n  LL t = getans(n, k, p);\n  cout << t << '\\n';\n}\n\nvoid PreTest() {\n  for(LL p = 2; p <= 1000000; p++) {\n    pp = p;\n    getans(576460752303423487LL, 576460752303423487LL, p);\n  }\n}\n\nvoid PreTwo() {\n  LL mod = VS;\n  special[0] = 0;\n  special[1] = 1;\n  for(int i=2;i<mod;i++) {\n    special[i] = (special[i-1]+special[i-2]);\n    if(special[i] >= mod) special[i] -= mod;\n  }\n}\n\nint main() {\n  PreCompute();\n  PreTwo();\n  // PreTest();\n  int T;\n  cin >> T;\n  while(T--) solve();\n  return 0;\n}\n"}]}]},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"å¤¢æœˆèªª"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"é€™é¡Œæ‡‰è©²è¦ 150 è¡Œä»¥å…§å¯«å®Œæ‰é«˜ç«¿å•Šã€‚"}]},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"é—œæ–¼ç«¶ç¨‹æ—¥è¨˜"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"ğŸ… å¦‚æœæ‚¨æƒ³åˆ°æ›´å¤šæœ‰è¶£æ¼‚äº®ç°¡å–®ä¹¾æ·¨çš„è§£æ³•è©±æ­¡è¿ç•™è¨€çµ¦ç«¶ç¨‹æ—¥è¨˜å°ç·¨ç¾¤ï¼"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"â„¹ï¸ é€™æ˜¯ä¸€ç¯‡æŠ•ç¨¿çµ¦"},{"type":"element","tagName":"a","properties":{"href":"https://www.facebook.com/%E7%AB%B6%E7%A8%8B%E6%97%A5%E8%A8%98-1514973425463954/"},"children":[{"type":"text","value":"ç«¶ç¨‹æ—¥è¨˜"}]},{"type":"text","value":"çš„æ–‡ç« ï¼Œæ­¡è¿å¤§å®¶æŠ•ç¨¿ã€äº¤æµèˆ‡åˆ†äº«ç¨‹å¼è§£é¡Œç«¶è³½çš„é»é»æ»´æ»´ï¼"}]}]},"frontmatter":{"date":"January 13, 2019","path":"/problem/icpc/asia_hanoi_2018/F","title":"Fun with Fibonacci","description":"è²»æ°æ•¸åˆ—çš„éè¿´å®šç¾©å¦‚ä¸‹ï¼š\n\n$$ F_n = F_{n-1} + F_{n-2} $$\n\nåˆå§‹æ¢ä»¶ç‚º $F_0=0, F_1=1$ã€‚é€™å€‹æ•¸åˆ—çš„é¦–å¹¾é …ç‚º 0, 1, 1, 2, 3, 5, 8, 13, 21, ...\n\næˆ‘å€‘ç¾åœ¨å®šç¾©èª‡å¼µç‰ˆçš„è²»æ°æ•¸åˆ—\n\n* å®šç¾© $G(1, n)$ ç‚ºç¬¬ $n$ å€‹è²»æ°æ•¸åˆ—ã€‚\n* å®šç¾© $G(2, n) = G(1, G(1, n))$ã€‚\n* å°æ–¼ä»»æ„æ­£æ•´æ•¸ $i$ï¼Œå®šç¾© $G(i, n) = G(1, G(i-1, n))$ã€‚\n\nçµ¦å®š $n, k, p$ï¼Œè«‹ä½ è¨ˆç®— $G(k, n)\\bmod p$ ä¹‹å€¼ã€‚\n","roadmap_label_h3":null,"backlink":"/icpcblog-weekly-2019"}}},"pageContext":{}}