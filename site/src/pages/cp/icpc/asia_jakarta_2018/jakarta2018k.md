---
category: "prob"
code: "ICPC-JAKARTA-2018-K"
path: "/problem/icpc/asia_jakarta_2018/K"
title: "Boomerangs"
date: '2019-01-07'
difficulty: 4
description: |
    çµ¦å®šä¸€å€‹æœ‰ $N$ å€‹é»å’Œ $M$ æ¢é‚Šçš„ç°¡å–®åœ– $G=(V, E)$ã€‚æˆ‘å€‘å®šç¾©åœ– $G$ ä¸Šçš„ä¸‰å…ƒæ•¸å° $\langle u, v, w\rangle$ è¢«ç¨±ç‚ºã€Œè¿´åŠ›æ¨™ã€è‹¥ä¸”å”¯è‹¥ $\set{(u, v), (v, w)}\subseteq E$ è€Œä¸” $u\neq w$ã€‚

    çµ¦ä½ åœ– $G$ï¼Œè«‹æ‰¾å‡ºæœ€å¤§çš„é‚Šä¸é‡è¤‡ã€Œè¿´åŠ›æ¨™é›†åˆã€ã€‚ä¹Ÿå°±æ˜¯èªªï¼Œä½ è¦è¼¸å‡ºç›¡é‡å¤šçš„è¿´åŠ›æ¨™ä¸‰å…ƒæ•¸å°ï¼Œè€Œä¸”æ²’æœ‰ä¸€æ¢é‚Šå‡ºç¾åœ¨å…©å€‹ä½ è¼¸å‡ºçš„è¿´åŠ›æ¨™è£¡é¢ã€‚è‹¥æœ‰å¤šçµ„è§£çš„è©±ï¼Œè¼¸å‡ºä»»ä½•ä¸€çµ„éƒ½å¯ä»¥ã€‚
    
link: "https://codeforces.com/gym/102001/problem/K"
oj: "codeforces-gym"
backlink: "/icpcblog-weekly-2019"
tags:
    - "ICPC 2018 Asia Jakarta Regional"
---

## ç°¡åŒ–å¾Œé¡Œç›®æ•˜è¿°

<showvariable varname="description"></showvariable>

## è¼¸å…¥èªªæ˜

ç¬¬ä¸€åˆ—åŒ…å«å…©å€‹æ­£æ•´æ•¸ $N, M$ ($1\le N, M\le 100000$)ã€‚ç¬¬äºŒåˆ—é–‹å§‹æœ‰ $M$ åˆ—ï¼Œæ¯ä¸€åˆ—åŒ…å«å…©å€‹æ•´æ•¸ $u_i, v_i$ ($1\le u_i < v_i \le N$) ä»£è¡¨ä¸€æ¢åœ–ä¸Šçš„é‚Šï¼Œä½ å¯ä»¥å‡è¨­åœ–ä¸Šçš„é‚Šä¸æœƒé‡è¤‡åœ¨è¼¸å…¥å‡ºç¾ã€‚

## è¼¸å‡ºèªªæ˜

ç¬¬ä¸€åˆ—è¼¸å‡ºä¸€å€‹æ•´æ•¸ $K$ è¡¨ç¤ºæœ€å¤§çš„è¿´åŠ›æ¨™é›†åˆå¤§å°ã€‚æ¥ä¸‹ä¾†çš„ $K$ åˆ—ï¼Œæ¯ä¸€åˆ—è«‹è¼¸å‡ºä¸‰å€‹ç”±å–®ä¸€ç©ºç™½é–“éš”é–‹çš„æ•´æ•¸ï¼Œä»£è¡¨ä¸€å€‹è¿´åŠ›æ¨™ $\langle u, v, w\rangle$ã€‚

### ç¯„ä¾‹è¼¸å…¥ 1

```
5 7
1 2
1 4
2 3
2 4
2 5
3 4
3 5
```

### ç¯„ä¾‹è¼¸å‡º 1

```
3
4 1 2
4 3 2
2 5 3
```

### ç¯„ä¾‹è¼¸å…¥ 2

```
4 6
1 2
1 3
1 4
2 3
2 4
3 4
```

### ç¯„ä¾‹è¼¸å‡º 2

```
3
1 2 3
1 3 4
1 4 2
```

### ç¯„ä¾‹è¼¸å…¥ 3

```
3 3
1 2
1 3
2 3
```

### ç¯„ä¾‹è¼¸å‡º 3

```
1
2 1 3
```

## OJ é€£çµ

* [Codeforces Gym 102001 - K](https://codeforces.com/gym/102001/problem/K)


---

## è§£æ³•

é€™å€‹é¡Œç›®å¾ˆå·§å¦™åœ°åˆ©ç”¨äº†åœ¨åœ–ä¸Šé€²è¡Œ DFS ï¼ˆæˆ– BFSï¼‰éæ­·çš„ç‰¹æ€§ã€‚

æˆ‘å€‘ä¸å¦¨å‡è¨­æ•´å€‹åœ– $G$ æ˜¯é€£é€šçš„ï¼Œè€ƒæ…®å¾ $G$ ä¸Šé¢ä»»ä½•ä¸€å€‹é»å‡ºç™¼å…ˆåšä¸€æ¬¡ DFSã€‚
ç”±æ–¼é€™å€‹åœ–æ˜¯ç„¡å‘åœ–ï¼Œæ‰€æœ‰çš„é‚Šæœƒæ ¹æ“šæœç´¢çš„æƒ…å½¢è¢«åˆ†æˆå…©ç¨®ï¼šåœ¨ DFS æ¨¹ä¸Šçš„é‚Šï¼ˆæˆ‘å€‘ç¨±ç‚º tree edgeï¼‰ã€ä»¥åŠä¸åœ¨æ¨¹ä¸Šçš„é‚Šï¼ˆæ­¤æ™‚ç¨±ç‚º back edgeï¼Œå› ç‚ºç™¼ç¾æ™‚ä¸€å®šé€£åˆ° DFS æ¨¹ä¸Šçš„ç¥–å…ˆï¼‰ã€‚
æˆ‘å€‘å¯ä»¥æŠŠæ‰€æœ‰çš„ back edgeã€Œæ›åœ¨ã€æ¯”è¼ƒæ·±çš„é»ï¼Œé€™éº¼ä¸€ä¾†æ•´å¼µåœ–å°±æœƒåœ¨æœç´¢çš„éç¨‹çœ‹èµ·ä¾†åƒæ˜¯ä¸€æ£µæ¨¹ï¼ˆBFSä¹Ÿæœƒæœ‰é¡ä¼¼çš„æ•ˆæœï¼‰ã€‚
å°æ–¼é€™æ¨£çš„æ¨¹ä¾†èªªï¼Œæˆ‘å€‘ç¸½å¯ä»¥å¾ã€Œè‘‰å­ã€çš„éƒ¨ä»½ä»¥ Greedy çš„æ–¹æ³•æ¯æ¬¡æŠ“ç›¸é€£çš„å…©æ¢ sibling é‚Šï¼ˆä»–å€‘éƒ½æ˜¯å¾åŒä¸€å€‹ç¯€é»å‡ºç™¼æ‰¾åˆ°çš„ï¼‰ï¼Œç„¶å¾ŒæŠŠå®ƒè®Šæˆè¿´åŠ›æ¨™ï¼Œç„¶å¾ŒæŠŠå…©æ¢é‚Šæ‹”æ‰ã€‚
ä¸é›£ç™¼ç¾ï¼Œé€™ç¨®æ‹”æ³•å¯ä»¥ä¿è­‰ (1) æ‹”å®Œä¹‹å¾Œæ•´å€‹åœ–é‚„æ˜¯é€£é€šçš„ã€ä»¥åŠ (2) å‰©ä¸‹çš„åœ–ç”¨ã€Œæ•¸å­¸æ­¸ç´æ³•ã€ï¼Œä¿è­‰å¯ä»¥æ‹”å‡ºæœ€å¤§è¿´åŠ›æ¨™çš„æ•¸é‡ã€‚

å› æ­¤ï¼Œæ ¹æ“šä»¥ä¸Šçš„æ¼”ç®—æ³•ï¼Œæˆ‘å€‘ä¹Ÿåœ¨éç¨‹ä¸­è­‰æ˜äº†æœ€å¤§çš„è¿´åŠ›æ¨™æ•¸é‡ç¸½æ˜¯ $\lfloor |E|/2\rfloor$ çµ„ã€‚è€Œå¯¦ä½œä¸Šä¹Ÿå¯ä»¥é”åˆ°ç·šæ€§è¤‡é›œåº¦ï¼Œå¾ˆå°å“å§ ğŸ˜ƒ

<display
  graph
  undirected
  unweighted
  data='{
    "nodes": [1, 2, 3, 4, 5],
    "edges": [[1, 2], [1, 4], [2, 4], [2, 3], [3, 4], [2, 5], [3, 5]],
  }'
  uihelper-id-map='{
        "[1,2]":{stroke: "blue", strokeWidth: "5"},
        "[1,4]":{stroke: "blue", strokeWidth: "5"},
        "[2,4]":{stroke: "green", strokeWidth: "5"},
        "[2,3]":{stroke: "green", strokeWidth: "5"},
        "[3,4]":{stroke: "red", strokeWidth: "5"},
        "[3,5]":{stroke: "red", strokeWidth: "5"},
    }'>
</display>

### åƒè€ƒç¨‹å¼ç¢¼

```cpp
#include <iostream>
#include <tuple>
#include <vector>
using namespace std;

int N, M;
vector<int> a[100005];
int x[100005], y[100005];
int used[100005];
vector<tuple<int, int, int>> ans;

int neighbor(int eid, int u) { return x[eid] + y[eid] - u; }

// å¦‚æœ dfs å›ä¾†ä»¥å¾Œé‚„æœ‰ä¸€æ¢é‚Šæ²’æœ‰è¢«é…å°ï¼Œé‚£å°±å›å‚³é€™æ¢é‚Šï¼Œå¦å‰‡å›å‚³ -1ã€‚
int dfs(int u, int from=-1) {
  int at_hand = -1;
  // ä¾åºè€ƒæ…®éæ‰€æœ‰çš„é‚Šï¼Œä½†æ˜¯å› ç‚º dfs æœƒç¶“éåŒä¸€å€‹é»å¾ˆå¤šæ¬¡ï¼Œ
  // æ‰€ä»¥ä¸å¦¨ç”¨ä¸€å€‹é¡ä¼¼ stack çš„æ–¹å¼å¯¦ä½œï¼Œæ¯èµ°éä¸€æ¢é‚Šå°±æŠŠé€™æ¢é‚Šå»æ‰ã€‚
  while (!a[u].empty()) {
    int eid = a[u].back();
    a[u].pop_back();
    if (used[eid]) continue;
    used[eid] = true;
    int v = neighbor(eid, u);
    int ret = dfs(v, eid);
    if (ret == -1) continue;
    if (at_hand == -1) {
      at_hand = ret;
    } else {
      ans.emplace_back(v, u, neighbor(at_hand, u));
      at_hand = -1;
    }
  }
  if (at_hand != -1 && from != -1) {
    ans.emplace_back(neighbor(at_hand, u), u, neighbor(from, u));
    return -1;
  } else if (from != -1) {
    return from;
  }
  return -1;
}

int main() {
  cin >> N >> M;
  for (int i = 0; i < M; i++) {
    cin >> x[i] >> y[i];
    a[x[i]].push_back(i);
    a[y[i]].push_back(i);
  }
  // å°æ–¼æ¯å€‹é»é€²è¡Œ DFSï¼Œå¦‚æœæ—©å°±æ¢ç´¢å®Œäº†ï¼Œé‚£ç›¸é„°é‚Šä¹Ÿéƒ½æœƒè¢«æ‹”å…‰ï¼Œæ‰€ä»¥ä¸ç”¨æ“”å¿ƒé‡è¤‡æœç´¢ã€‚
  for (int i = 1; i <= N; i++) dfs(i);
  
  cout << ans.size() << endl;
  // C++17 Structural Binding å¥½ç‰©ï¼Œè¶Šä¾†è¶Šåƒ python äº†ã€‚
  for (auto [u, v, w]: ans)
    cout << u << " " << v << " " << w << '\n';
  return 0;
}
```

### å‚™è¨» 1

å…¶å¯¦é€™é¡Œçš„é‡é»åœ¨æ–¼æŠŠ Graph é€éæœç´¢çš„éç¨‹æ‹†æˆæ¨¹ï¼Œç„¶å¾Œåœ¨æ¨¹ä¸Šé¢åšè¿´åŠ›æ¨™çš„åˆ†çµ„ã€‚å¤§å®¶å¯ä»¥è©¦è‘—ç”¨ BFS å¯«çœ‹çœ‹ï½

### å‚™è¨» 2

ä¸å¥½æ„æ€ï¼Œä»Šå¤©æ“ä½œå‹å‹•ç•«ä¾†ä¸åŠç”Ÿå‡ºä¾†...å¦‚æœç”Ÿå‡ºä¾†çš„åœ–æœ‰é»é†œçš„è©±ï¼Œå¤§å®¶å¯ä»¥å¤šé‡æ–°æ•´ç†å¹¾æ¬¡å–”ï½

### é—œæ–¼ç«¶ç¨‹æ—¥è¨˜

ğŸ… å¦‚æœæ‚¨æƒ³åˆ°æ›´å¤šæœ‰è¶£æ¼‚äº®ç°¡å–®ä¹¾æ·¨çš„è§£æ³•è©±æ­¡è¿ç•™è¨€çµ¦ç«¶ç¨‹æ—¥è¨˜å°ç·¨ç¾¤ï¼

â„¹ï¸ é€™æ˜¯ä¸€ç¯‡æŠ•ç¨¿çµ¦[ç«¶ç¨‹æ—¥è¨˜](https://www.facebook.com/ç«¶ç¨‹æ—¥è¨˜-1514973425463954/)çš„æ–‡ç« ï¼Œæ­¡è¿å¤§å®¶æŠ•ç¨¿ã€äº¤æµèˆ‡åˆ†äº«ç¨‹å¼è§£é¡Œç«¶è³½çš„é»é»æ»´æ»´ï¼